/*
 * Note that this function uses *synchronous* JavaScript
 * There is a 2-second (2000 milliseconds) timer after which the JSON will be downloaded
 * so if the API calls are not finished by then, the JSON will only have the ones that did finish.
 * You can increase the timer if you need to.
 */

// load a default library that lets us read/write to the file system
var fs = require('fs')
// load a default library that lets us make HTTP requests (like calls to an API)
var request = require('request')

// endpoint URL
const url = 'https://api.harvardartmuseums.org/object/'

// object Ids I want to download
const myObjectIds = [
    // 369754, 55320, 221268, 222348, 223620, 223624, 226624, 229624, 230769, 230942, 231595, 126641, 147675, 174434, 186951, 192506, 195631, 197449, 197764, 213287, 213605, 213607, 213678, 213702, 250683, 255416, 255474, 256022, 262114, 262116, 272582, 273087, 273120, 274379, 278958, 279613, 280805, 280812, 281162, 283934, 283984, 283988, 296211, 297589, 304414, 311187, 316048, 317342, 317651, 322317,
    // 344398, 345470, 345589, 346233, 346278, 346284, 346398, 347248, 347268, 347269, 347392, 347458, 347564, 347741, 347760, 347777, 369754, 160473, 165181, 165216, 166105, 190588, 190869, 195632, 213606, 213609, 213721, 222679, 223423, 223612, 229465, 230155, 231084, 231707, 232626, 239478, 248007, 249568, 253338, 254308, 255215, 255799, 255874, 259325, 259430, 259581, 259633, 259739, 259990, 260097,
    // 260476, 261168, 261302, 261715, 262113, 262115, 270593, 272313, 272534, 273230, 278781, 278957, 279116, 279244, 279483, 280799, 280800, 280804, 280809, 280810, 280911, 281150, 281910, 283933, 283948, 283985, 284625, 284870, 294472, 297586, 297882, 298214, 299808, 302036, 305751, 308999, 309064, 310692, 312212, 312384, 337764, 345352, 345353, 345359, 345472, 345575, 346993, 347308, 356238, 356240,
    // 356241, 356242, 356243, 6877, 39230, 70935, 54457, 56407, 71397, 164643, 173196, 177302, 186947, 195298, 202247, 202499, 213608, 215499, 222229, 222346, 225857, 226026, 228144, 230107, 230199, 231199, 231305, 231427, 232461, 253453, 253471, 254480, 255114, 255473, 255477, 255690, 256518, 257076, 257767, 258756, 258984, 259295, 259335, 259347, 259361, 259445, 262075, 262978, 263284, 269018,
    // 272374, 276224, 276675, 278260, 279274, 280803, 280807, 281187, 284080, 284711, 285211, 295501, 296640, 296772, 299843, 306496, 308520, 308728, 310371, 323716, 329959, 337001, 344940, 345386, 345469, 346006, 346090, 346294, 346667, 346910, 347170, 347912, 348586, 350167, 356235, 359968, 369759, 20728, 28714, 29464, 49163, 167812, 170827, 172558, 185546, 186929, 186948, 190679, 193870, 195048,
    // 212123, 213701, 223622, 228006, 228071, 230065, 230072, 234735, 239581, 240369, 247875, 249534, 254145, 255025, 255106, 255701, 258708, 259360, 259371, 265144, 272535, 273098, 277505, 279115, 280798, 280806, 280811, 281142, 281149, 283337, 283746, 283935, 283936, 283953, 283986, 284081, 285450, 294708, 294753, 295157, 295672, 297130, 297145, 297881, 298905, 303565, 308507, 309033, 309432, 311767,
    // 316335, 342223, 343681, 345351, 346781, 347120, 347238, 347292, 347465, 347519, 347768, 350192, 356237, 356239, 369755, 18941, 93535, 94699, 94732, 99359, 148277, 159738, 159755, 161879, 164765, 164853, 187227, 189665, 192904, 197756, 197757, 213679, 213720, 217448, 218199, 219717, 219881, 220920, 221161, 222062, 222343, 223621, 223694, 223822, 227853, 230034, 230116, 230360, 230416, 230524,
    //this line and above lines are abandoned: 231163, 231272, 232986, 237758, 238157, 249808, 255585, 255850, 256056, 257431, 257996, 258156, 258160, 258709, 261332, 262052, 271838, 277831, 278173, 278684, 280801, 280802, 280808, 281084, 281128, 281147, 281148, 281161, 283987, 284079, 284082, 285167, 285478, 297128, 299997, 303670, 304344, 305777, 308310, 345358, 345694, 346144, 347152, 349499, 356236, 361203, 20969, 29004, 29428, 30388
    226624, 222348, 262114, 223620, 223624, 55320, 230942, 229624, 322317, 317342, 311187, 278958, 317651, 279613, 297589, 304414, 213287, 197764, 262116, 231595, 249568, 253338, 239478, 259633, 223423, 231707, 223612, 259739,
    254308, 248007, 190869, 165216, 232626, 222679, 165181, 230155, 260097, 259581, 261168, 262115, 270593, 279483, 273230, 278957, 312212, 298214, 310692, 305751, 294472, 297882,
    308999, 312384, 272313, 279244, 261715, 299808, 262113, 228144, 230199, 259445, 269018, 255690, 257076, 255114, 231305, 231199, 259295, 202499, 258984, 262075, 71397, 6877, 230107, 222346,
    173196, 257767, 276224, 310371, 295501, 49163, 296772, 308728, 195048, 20728, 172558, 348586, 296640, 306496, 323716, 279274, 337001, 299843, 259360, 228071, 228006, 212123, 239581, 255106, 247875, 294753, 277505,
    294708, 265144, 298905, 297881, 303565, 255025, 285450, 255701, 240369, 234735, 230065, 311767, 295157, 230072, 295672, 297130, 94699, 197757, 223621, 230116, 230524, 227853, 230416, 222343, 230034, 94732, 316335,
    230360, 223694, 93535, 99359, 257996, 237758, 258160, 256056, 257431, 231272, 20969, 303670, 238157, 308310, 231163, 249808
]
// set up empty Array for us to save results to
const myArray = [];

function fetchUrl(objectId){
    request(url + objectId + '?apikey=6cf1487e-7015-428a-9603-4615707aebe0', function (error, response, body) {
        console.error('error:', error); // Print the error if one occurred
        console.log('statusCode:', response && response.statusCode); // Print the response status code if a response was received

        let obj = JSON.parse(body);

        console.log(obj.primaryimageurl);
        let index = myArray.length;
        if (obj.people[0].gender === "female") {
            myArray[index] = {};
            myArray[index]["objectID"] = obj.objectid;
            myArray[index]["title"] = obj.title;
            myArray[index]["artist"] = obj.people[0].displayname;
            myArray[index]["gender"] = obj.people[0].gender;
            myArray[index]["culture"] = obj.people[0].culture;
            if (obj.datebegin === 0) {
                myArray[index]["date"] = null;
            } else {
                myArray[index]["date"] = obj.datebegin;
            }
            myArray[index]["primaryImage"] = obj.primaryimageurl;
            myArray[index]["classification"] = obj.classification;
            myArray[index]["technique"] = obj.technique;
            myArray[index]["museumURL"] = obj.url;
            myArray[index]["filename"] = obj.objectid + ".jpg";
            myArray[index]["from"] = "Harvard Art Museum"
            myArray[index]["wall_description"] = obj.images[0].description;
        }

    });
}

// call the function for each element in the myObjectIds array
myObjectIds.forEach(objectId => {
    fetchUrl(objectId);
});

// fetchUrl(myObjectIds[0]);


// the function inside the setTimeout saves myResults to a JSON
// it will automatically run after 2000 ms
setTimeout(() => {
    fs.writeFileSync('./portraitsData_2.json', JSON.stringify(myArray), 'utf8')
}, 10000)
